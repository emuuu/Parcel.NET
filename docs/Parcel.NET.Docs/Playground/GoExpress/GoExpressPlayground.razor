@namespace Parcel.NET.Docs.Playground.GoExpress
@inject PlaygroundSessionService Session
@inject CarrierClientFactory ClientFactory

<h1 class="h3 mb-3">GO! Express Sandbox Playground</h1>
<p class="text-muted mb-4">Test GO! Express Shipping API operations against the sandbox environment.</p>

<CredentialsPanel Title="GO! Express Credentials" IsComplete="@Session.GoExpressCredentials.IsComplete">
    <GoExpressCredentialsForm Credentials="Session.GoExpressCredentials" OnChanged="StateHasChanged" />
</CredentialsPanel>

<OperationSelector Operations="_operations" Selected="@_selectedOp"
                   OnSelected="op => { _selectedOp = op; _result = null; }" />

@switch (_selectedOp)
{
    case "CreateShipment":
        <GoExpressCreateShipmentForm CredentialsReady="Session.GoExpressCredentials.IsComplete" OnResult="HandleResult" />
        break;
    case "CancelShipment":
        <GoExpressCancelShipmentForm CredentialsReady="Session.GoExpressCredentials.IsComplete" OnResult="HandleResult" />
        break;
    case "GenerateLabel":
        <GoExpressGenerateLabelForm CredentialsReady="Session.GoExpressCredentials.IsComplete" OnResult="HandleResult" />
        break;
}

<ResponseViewer Result="_result" />

@if (_result?.IsSuccess == true && _labels is { Count: > 0 })
{
    <LabelViewer Labels="_labels" FileName="goexpress-label" />
}

@code {
    private readonly List<string> _operations = ["CreateShipment", "CancelShipment", "GenerateLabel"];

    private string _selectedOp = "CreateShipment";
    private PlaygroundResult? _result;
    private List<Parcel.NET.Abstractions.Models.ShipmentLabel>? _labels;

    private void HandleResult(PlaygroundResult result)
    {
        _result = result;
        _labels = null;

        if (result.IsSuccess && result.Data is Parcel.NET.Abstractions.Models.ShipmentResponse sr)
        {
            _labels = sr.Labels;
        }
        else if (result.IsSuccess && result.Data is Parcel.NET.Abstractions.Models.ShipmentLabel sl)
        {
            _labels = [sl];
        }
    }
}
